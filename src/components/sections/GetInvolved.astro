---
import { IDS, BEASCOUT_URL, GOOGLE_FORM_URL } from "../../data/site";

// Load content from Markdown
const [mod] = await Astro.glob("../../data/get-involved.md");
const fm = (mod?.frontmatter ?? {}) as {
  title?: string;
  intro?: string;
  cards?: { title: string; text: string; button?: string; href?: string }[];
};

function tplHref(s: string | undefined): string {
  const raw = s ?? "";
  return raw
    .replaceAll("{{BEASCOUT_URL}}", BEASCOUT_URL)
    .replaceAll("{{GOOGLE_FORM_URL}}", GOOGLE_FORM_URL)
    .replaceAll("{{IDS.whoWeAre}}", "#" + IDS.whoWeAre)
    .replaceAll("{{IDS.whyJoin}}", "#" + IDS.whyJoin)
    .replaceAll("{{IDS.program}}", "#" + IDS.program)
    .replaceAll("{{IDS.getInvolved}}", "#" + IDS.getInvolved)
    .replaceAll("{{IDS.contact}}", "#" + IDS.contact);
}

const cards = (fm.cards ?? [
  { title: "Visit Us", text: "Come to a Monday night meeting and see what weâ€™re all about.", button: "Plan a Visit", href: "{{IDS.program}}" },
  { title: "Apply Online", text: "Join Pack 151 today through BeAScout.org.", button: "BeAScout", href: "{{BEASCOUT_URL}}" },
  { title: "Contact Us", text: "Fill out the form below and a Pack leader will be in touch.", button: "Open Form", href: "{{GOOGLE_FORM_URL}}" },
]).map((c) => ({ ...c, href: tplHref(c.href) }));

const btnClassFor = (i: number) => (i === 0 ? "btn btn-primary" : i === 1 ? "btn btn-secondary" : "btn");
---

<section id={IDS.getInvolved} class="py-16 bg-base-200">
  <div class="container mx-auto px-4 max-w-6xl">
    <div class="mb-10 text-center">
      <h2 class="text-3xl font-bold">{fm.title ?? "Get Involved"}</h2>
      {fm.intro && <p class="mt-3 text-lg">{fm.intro}</p>}
    </div>

    <div class="grid gap-6 md:grid-cols-3">
      {cards.map((c, i) => (
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h3 class="card-title">{c.title}</h3>
            <p>{c.text}</p>
            <div class="card-actions justify-end">
              <a href={c.href} class={btnClassFor(i)} rel="noopener">{c.button ?? "Learn More"}</a>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>